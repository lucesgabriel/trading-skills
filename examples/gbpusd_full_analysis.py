import pandas as pd
import numpy as np
from io import StringIO

# Datos completos H1 GBPUSD (todas las 250 velas - mostrando las últimas 100 para el análisis)
h1_csv = """time,open,high,low,close,tick_volume,spread,real_volume
2025-09-01 04:00:00+00:00,1.35183,1.35291,1.3505,1.35181,24316,0,0
2025-09-01 08:00:00+00:00,1.35182,1.35407,1.35148,1.3535300000000001,28724,0,0
2025-09-01 12:00:00+00:00,1.3535300000000001,1.35376,1.35222,1.35331,25051,0,0
2025-09-01 16:00:00+00:00,1.35333,1.35499,1.35308,1.35422,23455,0,0
2025-09-01 20:00:00+00:00,1.3542100000000001,1.35501,1.354,1.35437,7113,0,0
2025-09-02 00:00:00+00:00,1.35382,1.35494,1.35331,1.35374,10002,0,0
2025-09-02 04:00:00+00:00,1.35375,1.35416,1.3523,1.35277,20076,0,0
2025-09-02 08:00:00+00:00,1.35276,1.35337,1.33752,1.3413599999999999,44878,0,0
2025-09-02 12:00:00+00:00,1.34137,1.34181,1.334,1.3351899999999999,46146,0,0
2025-09-02 16:00:00+00:00,1.3351899999999999,1.34188,1.33422,1.33925,46449,0,0
2025-09-02 20:00:00+00:00,1.33924,1.33975,1.33749,1.33965,19363,0,0
2025-09-03 00:00:00+00:00,1.33878,1.33964,1.33716,1.33758,10990,0,0
2025-09-03 04:00:00+00:00,1.33757,1.3378,1.33603,1.33694,18679,0,0
2025-09-03 08:00:00+00:00,1.33693,1.3409499999999999,1.3332899999999999,1.3406799999999999,34557,0,0
2025-09-03 12:00:00+00:00,1.34066,1.34298,1.33947,1.34249,32352,0,0
2025-09-03 16:00:00+00:00,1.3425,1.34541,1.341,1.34501,28251,0,0
2025-09-03 20:00:00+00:00,1.34503,1.34584,1.34344,1.34458,13788,0,0
2025-09-04 00:00:00+00:00,1.34396,1.3444099999999999,1.34336,1.3442,13421,0,0
2025-09-04 04:00:00+00:00,1.34419,1.3450199999999999,1.3425099999999999,1.3427,18867,0,0
2025-09-04 08:00:00+00:00,1.34269,1.3457,1.34161,1.34543,25306,0,0
2025-09-04 12:00:00+00:00,1.34543,1.34595,1.34219,1.3441100000000001,31530,0,0
2025-09-04 16:00:00+00:00,1.3441,1.34469,1.34168,1.34214,37556,0,0
2025-09-04 20:00:00+00:00,1.34214,1.3437299999999999,1.34188,1.34355,12954,0,0
2025-09-05 00:00:00+00:00,1.34297,1.34505,1.34201,1.3449599999999999,11535,0,0
2025-09-05 04:00:00+00:00,1.34496,1.34573,1.3446500000000001,1.3450199999999999,21414,0,0
2025-09-05 08:00:00+00:00,1.3450199999999999,1.34723,1.34496,1.34699,26371,0,0
2025-09-05 12:00:00+00:00,1.34701,1.35339,1.3458,1.35211,37568,0,0
2025-09-05 16:00:00+00:00,1.35211,1.3555,1.35047,1.3525800000000001,55523,0,0
2025-09-05 20:00:00+00:00,1.35262,1.35263,1.3501,1.35061,21705,0,0
2025-10-14 10:00:00+00:00,1.32804,1.32836,1.32521,1.32569,16542,0,0
2025-10-14 11:00:00+00:00,1.32568,1.32839,1.32532,1.32836,12043,0,0
2025-10-14 12:00:00+00:00,1.3283800000000001,1.3284099999999999,1.32638,1.32679,12028,0,0
2025-10-14 13:00:00+00:00,1.3268,1.3271899999999999,1.3258,1.32649,12040,0,0
2025-10-14 14:00:00+00:00,1.32649,1.32755,1.32612,1.32686,11834,0,0
2025-10-14 15:00:00+00:00,1.32686,1.32728,1.3248199999999999,1.32616,13982,0,0
2025-10-14 16:00:00+00:00,1.32616,1.32956,1.3260100000000001,1.32823,17579,0,0
2025-10-14 17:00:00+00:00,1.32823,1.3303099999999999,1.32793,1.32966,17076,0,0
2025-10-14 18:00:00+00:00,1.3296700000000001,1.33194,1.3287900000000001,1.33175,14804,0,0
2025-10-14 19:00:00+00:00,1.33175,1.33295,1.33066,1.33175,13640,0,0
2025-10-14 20:00:00+00:00,1.33175,1.33298,1.3312,1.33276,9408,0,0
2025-10-14 21:00:00+00:00,1.33278,1.33319,1.33199,1.33277,6795,0,0
2025-10-14 22:00:00+00:00,1.33277,1.3332,1.33224,1.33254,8148,0,0
2025-10-14 23:00:00+00:00,1.33252,1.33273,1.33137,1.3318400000000001,3015,2,0
2025-10-15 00:00:00+00:00,1.33162,1.3321,1.33113,1.33151,992,25,0
2025-10-15 01:00:00+00:00,1.33151,1.33231,1.3314300000000001,1.33192,2760,2,0
2025-10-15 02:00:00+00:00,1.33192,1.3324799999999999,1.33166,1.33221,2595,0,0
2025-10-15 03:00:00+00:00,1.33221,1.33307,1.33196,1.33285,7422,0,0
2025-10-15 04:00:00+00:00,1.33284,1.33409,1.33254,1.334,7781,0,0
2025-10-15 05:00:00+00:00,1.33402,1.3351600000000001,1.3338999999999999,1.33494,6404,0,0
2025-10-15 06:00:00+00:00,1.33493,1.33538,1.33476,1.33511,4675,0,0
2025-10-15 07:00:00+00:00,1.3351199999999999,1.3354300000000001,1.3345,1.33486,4820,0,0
2025-10-15 08:00:00+00:00,1.33487,1.33589,1.33461,1.3353,5538,0,0
2025-10-15 09:00:00+00:00,1.33528,1.3373300000000001,1.33506,1.33625,11217,0,0
2025-10-15 10:00:00+00:00,1.33628,1.33643,1.33419,1.335,12650,0,0
2025-10-15 11:00:00+00:00,1.33499,1.33558,1.33409,1.33454,11851,0,0
2025-10-15 12:00:00+00:00,1.33453,1.33576,1.33357,1.33508,11036,0,0
2025-10-15 13:00:00+00:00,1.33508,1.33657,1.33464,1.33643,7877,0,0
2025-10-15 14:00:00+00:00,1.33644,1.33669,1.33497,1.3352,6706,0,0
2025-10-15 15:00:00+00:00,1.33521,1.33566,1.3341,1.3346,12513,0,0
2025-10-15 16:00:00+00:00,1.33459,1.33528,1.33346,1.33493,15885,0,0
2025-10-15 17:00:00+00:00,1.33494,1.33666,1.33461,1.33653,12364,0,0
2025-10-15 18:00:00+00:00,1.33654,1.34036,1.3362,1.33941,13940,0,0
2025-10-15 19:00:00+00:00,1.33941,1.33949,1.33846,1.33908,12166,0,0
2025-10-15 20:00:00+00:00,1.33907,1.33908,1.33717,1.3377,11742,0,0
2025-10-15 21:00:00+00:00,1.33771,1.33871,1.33704,1.33826,7434,0,0
2025-10-15 22:00:00+00:00,1.33827,1.33936,1.33826,1.33932,5662,0,0
2025-10-15 23:00:00+00:00,1.33931,1.3407499999999999,1.33917,1.34029,4342,2,0
2025-10-16 00:00:00+00:00,1.34029,1.34029,1.33874,1.33901,1197,3,0
2025-10-16 01:00:00+00:00,1.33896,1.3408,1.33896,1.34033,4133,2,0
2025-10-16 02:00:00+00:00,1.34033,1.34048,1.34,1.34035,3663,0,0
2025-10-16 03:00:00+00:00,1.34033,1.34281,1.33997,1.34218,10571,0,0
2025-10-16 04:00:00+00:00,1.3421699999999999,1.34419,1.34213,1.34357,9070,0,0
2025-10-16 05:00:00+00:00,1.34357,1.34396,1.3428499999999999,1.34306,6130,0,0
2025-10-16 06:00:00+00:00,1.34305,1.34321,1.34215,1.3421699999999999,4890,0,0
2025-10-16 07:00:00+00:00,1.34218,1.34232,1.34123,1.3414,3834,0,0
2025-10-16 08:00:00+00:00,1.3414,1.34207,1.34112,1.34166,6792,0,0
2025-10-16 09:00:00+00:00,1.34164,1.34232,1.3404099999999999,1.34106,11982,0,0
2025-10-16 10:00:00+00:00,1.34105,1.34283,1.34079,1.3426,14508,0,0
2025-10-16 11:00:00+00:00,1.3426,1.34433,1.34234,1.3437999999999999,10826,0,0
2025-10-16 12:00:00+00:00,1.34379,1.34417,1.34324,1.34353,8707,0,0
2025-10-16 13:00:00+00:00,1.34355,1.34483,1.34296,1.3433899999999999,9060,0,0
2025-10-16 14:00:00+00:00,1.34338,1.34453,1.34212,1.34403,10260,0,0
2025-10-16 15:00:00+00:00,1.34403,1.3449200000000001,1.34234,1.34473,12374,0,0
2025-10-16 16:00:00+00:00,1.34473,1.34544,1.342,1.34201,14853,0,0
2025-10-16 17:00:00+00:00,1.34203,1.34359,1.34113,1.34337,17414,0,0
2025-10-16 18:00:00+00:00,1.34338,1.3436,1.34176,1.34226,16739,0,0
2025-10-16 19:00:00+00:00,1.34226,1.34334,1.34144,1.34266,14618,0,0
2025-10-16 20:00:00+00:00,1.34265,1.3448,1.34254,1.34378,9524,0,0
2025-10-16 21:00:00+00:00,1.3437700000000001,1.34385,1.3419699999999999,1.3434599999999999,9536,0,0
2025-10-16 22:00:00+00:00,1.34347,1.34383,1.343,1.34336,7424,0,0
2025-10-16 23:00:00+00:00,1.34336,1.34369,1.34307,1.34345,3516,2,0
2025-10-17 00:00:00+00:00,1.3427,1.34354,1.34263,1.34301,1439,34,0
2025-10-17 01:00:00+00:00,1.34295,1.3445,1.34284,1.34366,3469,2,0
2025-10-17 02:00:00+00:00,1.34366,1.34454,1.34359,1.3444,3472,0,0
2025-10-17 03:00:00+00:00,1.34442,1.34522,1.34396,1.3446799999999999,6801,0,0
2025-10-17 04:00:00+00:00,1.34467,1.34516,1.34378,1.34387,8890,0,0
2025-10-17 05:00:00+00:00,1.34387,1.34489,1.34313,1.34443,6726,0,0
2025-10-17 06:00:00+00:00,1.34442,1.34514,1.3443399999999999,1.3448,5103,0,0
2025-10-17 07:00:00+00:00,1.34481,1.3454,1.34456,1.34522,4298,0,0
2025-10-17 08:00:00+00:00,1.34522,1.3471,1.34513,1.34686,6009,0,0
2025-10-17 09:00:00+00:00,1.34687,1.34717,1.345,1.3455,11012,0,0
2025-10-17 10:00:00+00:00,1.34549,1.34578,1.34241,1.34318,15150,0,0
2025-10-17 11:00:00+00:00,1.3431899999999999,1.34375,1.34107,1.34237,10714,0,0
2025-10-17 12:00:00+00:00,1.34236,1.34398,1.34233,1.34358,8744,0,0
2025-10-17 13:00:00+00:00,1.34359,1.34418,1.34274,1.3434300000000001,9115,0,0
2025-10-17 14:00:00+00:00,1.3434599999999999,1.3443399999999999,1.34301,1.34348,10974,0,0
2025-10-17 15:00:00+00:00,1.34349,1.34357,1.34082,1.34124,12925,0,0
2025-10-17 16:00:00+00:00,1.34124,1.3423,1.3401,1.3404,13006,0,0
2025-10-17 17:00:00+00:00,1.3404099999999999,1.34093,1.3391199999999999,1.33921,15985,0,0
2025-10-17 18:00:00+00:00,1.33921,1.3422399999999999,1.33907,1.34223,12142,0,0
2025-10-17 19:00:00+00:00,1.34222,1.34311,1.34125,1.34173,9190,0,0
2025-10-17 20:00:00+00:00,1.34173,1.3425099999999999,1.34106,1.3416299999999999,8162,0,0
2025-10-17 21:00:00+00:00,1.3416299999999999,1.34392,1.3413300000000001,1.34336,7453,0,0
2025-10-17 22:00:00+00:00,1.34336,1.34379,1.34288,1.34378,5392,0,0
2025-10-17 23:00:00+00:00,1.3437700000000001,1.3437999999999999,1.34207,1.34262,3981,2,0
2025-10-20 00:00:00+00:00,1.34234,1.34291,1.34159,1.34192,2036,57,0
2025-10-20 01:00:00+00:00,1.34192,1.34296,1.34191,1.3428,2993,2,0
2025-10-20 02:00:00+00:00,1.3428,1.34307,1.34245,1.3425099999999999,2521,0,0
2025-10-20 03:00:00+00:00,1.34252,1.3435000000000001,1.34212,1.3434,5575,0,0
2025-10-20 04:00:00+00:00,1.3434,1.34372,1.34267,1.34327,5862,0,0
2025-10-20 05:00:00+00:00,1.34327,1.3443399999999999,1.3432,1.34353,4215,0,0
2025-10-20 06:00:00+00:00,1.34352,1.34413,1.34338,1.34402,3045,0,0
2025-10-20 07:00:00+00:00,1.34403,1.3443,1.34351,1.34356,3746,0,0
2025-10-20 08:00:00+00:00,1.34355,1.34413,1.34324,1.3440699999999999,4527,0,0
2025-10-20 09:00:00+00:00,1.34406,1.3440699999999999,1.34152,1.34164,8652,0,0
2025-10-20 10:00:00+00:00,1.34165,1.3428,1.34058,1.34159,10059,0,0
2025-10-20 11:00:00+00:00,1.3416000000000001,1.34284,1.34116,1.34279,8778,0,0
2025-10-20 12:00:00+00:00,1.34279,1.3439,1.34247,1.3428,9180,0,0
2025-10-20 13:00:00+00:00,1.3428,1.34321,1.34101,1.34105,7628,0,0
2025-10-20 14:00:00+00:00,1.34106,1.34135,1.34001,1.34117,7204,0,0
2025-10-20 15:00:00+00:00,1.34117,1.34297,1.3409499999999999,1.3425500000000001,9012,0,0
2025-10-20 16:00:00+00:00,1.3425500000000001,1.34269,1.34025,1.34046,9443,0,0
2025-10-20 17:00:00+00:00,1.34046,1.3425,1.34019,1.34164,8391,0,0
2025-10-20 18:00:00+00:00,1.34164,1.34277,1.34104,1.34198,8493,0,0
2025-10-20 19:00:00+00:00,1.34198,1.34237,1.34114,1.3415599999999999,7211,0,0
2025-10-20 20:00:00+00:00,1.34154,1.34164,1.34018,1.34023,5603,0,0
2025-10-20 21:00:00+00:00,1.34023,1.34115,1.33995,1.34089,4668,0,0
2025-10-20 22:00:00+00:00,1.3409,1.34128,1.34046,1.3406500000000001,3352,0,0
2025-10-20 23:00:00+00:00,1.34064,1.3411,1.3403800000000001,1.3404099999999999,2948,2,0
2025-10-21 00:00:00+00:00,1.3404099999999999,1.34089,1.33962,1.3404,1179,2,0
2025-10-21 01:00:00+00:00,1.3404,1.34088,1.3403399999999999,1.34042,1949,2,0
2025-10-21 02:00:00+00:00,1.34042,1.34053,1.34026,1.34045,1992,0,0
2025-10-21 03:00:00+00:00,1.34043,1.3416000000000001,1.34028,1.3414,5097,0,0
2025-10-21 04:00:00+00:00,1.3414,1.34143,1.33984,1.34005,5751,0,0
2025-10-21 05:00:00+00:00,1.34006,1.34008,1.33905,1.33926,5678,0,0
2025-10-21 06:00:00+00:00,1.33927,1.33937,1.33894,1.3393,3802,0,0
2025-10-21 07:00:00+00:00,1.3393,1.3394,1.33873,1.33923,4915,0,0
2025-10-21 08:00:00+00:00,1.33923,1.3394,1.33737,1.33748,6421,0,0
2025-10-21 09:00:00+00:00,1.33748,1.33923,1.33723,1.33897,8598,0,0
2025-10-21 10:00:00+00:00,1.33896,1.33976,1.33798,1.33929,11300,0,0
2025-10-21 11:00:00+00:00,1.33929,1.33929,1.33734,1.33801,12644,0,0
2025-10-21 12:00:00+00:00,1.33801,1.33918,1.33749,1.3384800000000001,8957,0,0
2025-10-21 13:00:00+00:00,1.3384800000000001,1.33878,1.33657,1.3383,9817,0,0
2025-10-21 14:00:00+00:00,1.3383,1.33944,1.33723,1.33842,8803,0,0
2025-10-21 15:00:00+00:00,1.33842,1.3389,1.33689,1.33869,12059,0,0
2025-10-21 16:00:00+00:00,1.33868,1.3388200000000001,1.33606,1.33766,13375,0,0
2025-10-21 17:00:00+00:00,1.33768,1.33864,1.33636,1.33731,13693,0,0
2025-10-21 18:00:00+00:00,1.33731,1.33939,1.3372899999999999,1.3388499999999999,11790,0,0
2025-10-21 19:00:00+00:00,1.3388499999999999,1.33981,1.33717,1.33735,11301,0,0
2025-10-21 20:00:00+00:00,1.33735,1.33735,1.3365,1.33721,8735,0,0
2025-10-21 21:00:00+00:00,1.3372,1.33769,1.33709,1.33723,5243,0,0
2025-10-21 22:00:00+00:00,1.33723,1.33757,1.33693,1.33722,4891,0,0
2025-10-21 23:00:00+00:00,1.33721,1.33723,1.33655,1.33694,2867,2,0
2025-10-22 00:00:00+00:00,1.33694,1.33694,1.33602,1.33683,960,8,0
2025-10-22 01:00:00+00:00,1.33683,1.33717,1.3366500000000001,1.33687,2194,2,0
2025-10-22 02:00:00+00:00,1.33687,1.33696,1.3363800000000001,1.33649,2537,0,0
2025-10-22 03:00:00+00:00,1.33649,1.33748,1.3364,1.33708,7092,0,0
2025-10-22 04:00:00+00:00,1.33708,1.33777,1.33676,1.33711,5510,0,0
2025-10-22 05:00:00+00:00,1.33712,1.33799,1.33711,1.33765,3606,0,0
2025-10-22 06:00:00+00:00,1.33765,1.33768,1.33708,1.33739,3313,0,0
2025-10-22 07:00:00+00:00,1.33739,1.33801,1.3373599999999999,1.33791,3631,0,0
2025-10-22 08:00:00+00:00,1.3378999999999999,1.33868,1.3378999999999999,1.33826,3777,0,0
2025-10-22 09:00:00+00:00,1.3382100000000001,1.33836,1.33289,1.33351,14259,0,0
2025-10-22 10:00:00+00:00,1.3335,1.33377,1.3319,1.33223,11216,0,0
2025-10-22 11:00:00+00:00,1.33223,1.33259,1.3312300000000001,1.33209,12574,0,0
2025-10-22 12:00:00+00:00,1.33209,1.33273,1.3316,1.33191,8236,0,0
2025-10-22 13:00:00+00:00,1.3319,1.33234,1.33052,1.33125,7733,0,0
2025-10-22 14:00:00+00:00,1.3312300000000001,1.3333300000000001,1.33112,1.33278,8233,0,0
2025-10-22 15:00:00+00:00,1.33278,1.33407,1.33097,1.33236,10050,0,0
2025-10-22 16:00:00+00:00,1.33236,1.3344,1.33158,1.33416,11250,0,0
2025-10-22 17:00:00+00:00,1.33416,1.33571,1.33413,1.33545,11274,0,0
2025-10-22 18:00:00+00:00,1.33545,1.33745,1.33539,1.33701,11155,0,0
2025-10-22 19:00:00+00:00,1.33705,1.3376299999999999,1.33644,1.33712,9374,0,0
2025-10-22 20:00:00+00:00,1.33712,1.3372600000000001,1.33579,1.33606,7831,0,0
2025-10-22 21:00:00+00:00,1.33606,1.3362,1.33533,1.33557,5820,0,0
2025-10-22 22:00:00+00:00,1.33558,1.33613,1.33527,1.33566,5409,0,0
2025-10-22 23:00:00+00:00,1.33563,1.33618,1.33555,1.33559,2823,2,0
2025-10-23 00:00:00+00:00,1.33496,1.33554,1.33473,1.33533,1986,25,0
2025-10-23 01:00:00+00:00,1.33533,1.336,1.33533,1.3356,2002,2,0
2025-10-23 02:00:00+00:00,1.3356,1.33564,1.33493,1.33508,2645,0,0
2025-10-23 03:00:00+00:00,1.33507,1.33508,1.3338999999999999,1.33454,5142,0,0
2025-10-23 04:00:00+00:00,1.3345500000000001,1.33475,1.33385,1.33388,4410,0,0
2025-10-23 05:00:00+00:00,1.33389,1.33398,1.33345,1.33369,3015,0,0
2025-10-23 06:00:00+00:00,1.3336999999999999,1.33404,1.33322,1.3332600000000001,2737,0,0
2025-10-23 07:00:00+00:00,1.3332600000000001,1.33396,1.33293,1.33392,2458,0,0
2025-10-23 08:00:00+00:00,1.33392,1.33507,1.33382,1.33474,3089,0,0
2025-10-23 09:00:00+00:00,1.33474,1.3357,1.33439,1.3349199999999999,7462,0,0
2025-10-23 10:00:00+00:00,1.3349199999999999,1.33559,1.33441,1.33507,7152,0,0
2025-10-23 11:00:00+00:00,1.33507,1.33555,1.33435,1.33497,7035,0,0
2025-10-23 12:00:00+00:00,1.33497,1.33545,1.33473,1.3349,5126,0,0
2025-10-23 13:00:00+00:00,1.33488,1.33521,1.33347,1.33372,6595,0,0
2025-10-23 14:00:00+00:00,1.33372,1.3342399999999999,1.33328,1.33359,5324,0,0
2025-10-23 15:00:00+00:00,1.33359,1.33504,1.33264,1.33429,7675,0,0
2025-10-23 16:00:00+00:00,1.3343,1.3348200000000001,1.3324,1.3326799999999999,9581,0,0
2025-10-23 17:00:00+00:00,1.33267,1.33375,1.33201,1.33221,10550,0,0
2025-10-23 18:00:00+00:00,1.33222,1.33257,1.33107,1.3321100000000001,8744,0,0
2025-10-23 19:00:00+00:00,1.3321100000000001,1.33263,1.3311899999999999,1.33124,5925,0,0
2025-10-23 20:00:00+00:00,1.33125,1.33213,1.33077,1.33173,5469,0,0
2025-10-23 21:00:00+00:00,1.33173,1.3324500000000001,1.33158,1.33234,3993,0,0
2025-10-23 22:00:00+00:00,1.33233,1.33267,1.33224,1.33237,3813,0,0
2025-10-23 23:00:00+00:00,1.33237,1.33281,1.3320699999999999,1.33247,2173,2,0
2025-10-24 00:00:00+00:00,1.33166,1.33252,1.33166,1.3324,4808,25,0
2025-10-24 01:00:00+00:00,1.3324,1.33298,1.3323800000000001,1.33261,2033,2,0
2025-10-24 02:00:00+00:00,1.33261,1.33283,1.33239,1.33264,1682,0,0
2025-10-24 03:00:00+00:00,1.33263,1.33323,1.33254,1.333,5089,0,0
2025-10-24 04:00:00+00:00,1.333,1.33311,1.33209,1.33215,6289,0,0
2025-10-24 05:00:00+00:00,1.33217,1.33264,1.33175,1.3318699999999999,5550,0,0
2025-10-24 06:00:00+00:00,1.3318699999999999,1.33281,1.33185,1.33251,4271,0,0
2025-10-24 07:00:00+00:00,1.3325,1.33254,1.33191,1.33209,3973,0,0
2025-10-24 08:00:00+00:00,1.33208,1.33213,1.3311600000000001,1.3317700000000001,4195,0,0
2025-10-24 09:00:00+00:00,1.33178,1.33338,1.3311899999999999,1.3332,9306,0,0
2025-10-24 10:00:00+00:00,1.3332,1.3333300000000001,1.33137,1.33154,10886,0,0
2025-10-24 11:00:00+00:00,1.33152,1.3326799999999999,1.33003,1.3320400000000001,10299,0,0
2025-10-24 12:00:00+00:00,1.33205,1.33254,1.3313,1.33216,7527,0,0
2025-10-24 13:00:00+00:00,1.33217,1.33255,1.33141,1.33174,6267,0,0
2025-10-24 14:00:00+00:00,1.33174,1.33201,1.32998,1.3306200000000001,7304,0,0
2025-10-24 15:00:00+00:00,1.3306200000000001,1.33682,1.33045,1.3345099999999999,15621,0,0
2025-10-24 16:00:00+00:00,1.3345099999999999,1.33589,1.3329,1.33381,15623,0,0
2025-10-24 17:00:00+00:00,1.33381,1.33392,1.32929,1.33006,14442,0,0
2025-10-24 18:00:00+00:00,1.33005,1.33081,1.3290600000000001,1.32966,10814,0,0
2025-10-24 19:00:00+00:00,1.32964,1.32991,1.3287499999999999,1.32955,6588,0,0
2025-10-24 20:00:00+00:00,1.32955,1.3307,1.32952,1.33026,5287,0,0
2025-10-24 21:00:00+00:00,1.33027,1.3306499999999999,1.33002,1.3304,4343,0,0
2025-10-24 22:00:00+00:00,1.33039,1.3312300000000001,1.33025,1.33115,3364,0,0
2025-10-24 23:00:00+00:00,1.33115,1.33178,1.3306499999999999,1.33102,4322,1,0
2025-10-27 00:00:00+00:00,1.3316,1.33223,1.33157,1.33199,2037,57,0
2025-10-27 01:00:00+00:00,1.33199,1.3327499999999999,1.33173,1.33227,4611,2,0
2025-10-27 02:00:00+00:00,1.33227,1.3324799999999999,1.3318400000000001,1.33218,3755,0,0
2025-10-27 03:00:00+00:00,1.33219,1.33284,1.33173,1.33236,6542,0,0
2025-10-27 04:00:00+00:00,1.33236,1.33356,1.33209,1.33279,7082,0,0
2025-10-27 05:00:00+00:00,1.33278,1.3328,1.33209,1.33231,4325,0,0
2025-10-27 06:00:00+00:00,1.3323,1.33269,1.33196,1.33215,4102,0,0
2025-10-27 07:00:00+00:00,1.33215,1.33223,1.33127,1.33162,3544,0,0
2025-10-27 08:00:00+00:00,1.33161,1.33224,1.33125,1.33206,4002,0,0
2025-10-27 09:00:00+00:00,1.33206,1.33346,1.33202,1.33237,5905,0,0
2025-10-27 10:00:00+00:00,1.33239,1.33259,1.33103,1.33157,7291,0,0
2025-10-27 11:00:00+00:00,1.33158,1.33339,1.33104,1.33263,9356,0,0
2025-10-27 12:00:00+00:00,1.33263,1.33469,1.33225,1.3345099999999999,9222,0,0
2025-10-27 13:00:00+00:00,1.33449,1.3351199999999999,1.33412,1.33444,6989,0,0
2025-10-27 14:00:00+00:00,1.33443,1.33535,1.33369,1.33475,6737,0,0
2025-10-27 15:00:00+00:00,1.33475,1.3351600000000001,1.33402,1.33477,8017,0,0
2025-10-27 16:00:00+00:00,1.33476,1.33515,1.33256,1.33347,8875,0,0
2025-10-27 17:00:00+00:00,1.33348,1.33372,1.33259,1.33311,9911,0,0
2025-10-27 18:00:00+00:00,1.33311,1.3333,1.33174,1.3329,9477,0,0
2025-10-27 19:00:00+00:00,1.33289,1.33351,1.33231,1.33349,6145,0,0
2025-10-27 20:00:00+00:00,1.33348,1.33392,1.33324,1.3333599999999999,5564,0,0
2025-10-27 21:00:00+00:00,1.33335,1.33389,1.33244,1.33376,5847,0,0
2025-10-27 22:00:00+00:00,1.33375,1.33389,1.33283,1.33352,5191,0,0
2025-10-27 23:00:00+00:00,1.33351,1.3338999999999999,1.33323,1.33346,2527,2,0
2025-10-28 00:00:00+00:00,1.33339,1.33375,1.33337,1.33356,3482,25,0
2025-10-28 01:00:00+00:00,1.33355,1.334,1.33354,1.33393,3184,2,0
2025-10-28 02:00:00+00:00,1.33393,1.33448,1.33382,1.33402,2001,0,0
2025-10-28 03:00:00+00:00,1.33401,1.33542,1.3336700000000001,1.33501,4663,0,0
2025-10-28 04:00:00+00:00,1.335,1.33583,1.33473,1.3351899999999999,7595,0,0
2025-10-28 05:00:00+00:00,1.3352,1.33586,1.33483,1.33487,5951,0,0
2025-10-28 06:00:00+00:00,1.33488,1.33579,1.3348200000000001,1.33558,5470,0,0
2025-10-28 07:00:00+00:00,1.33558,1.33673,1.3355299999999999,1.33658,6307,0,0
2025-10-28 08:00:00+00:00,1.33658,1.3369900000000001,1.33605,1.33624,6217,0,0
2025-10-28 09:00:00+00:00,1.33624,1.33673,1.33521,1.33526,7399,0,0
2025-10-28 10:00:00+00:00,1.33526,1.33529,1.33313,1.3336299999999999,8058,0,0
2025-10-28 11:00:00+00:00,1.33362,1.33383,1.3301,1.33079,11455,0,0
2025-10-28 12:00:00+00:00,1.33077,1.33222,1.3299699999999999,1.33176,8654,0,0
2025-10-28 13:00:00+00:00,1.3317700000000001,1.33283,1.33112,1.33249,8635,0,0
2025-10-28 14:00:00+00:00,1.3325,1.33256,1.33041,1.33079,7652,0,0
2025-10-28 15:00:00+00:00,1.3308200000000001,1.33138,1.3279,1.3284,10100,0,0
2025-10-28 16:00:00+00:00,1.3284,1.32854,1.32476,1.3256000000000001,11610,0,0
2025-10-28 17:00:00+00:00,1.32564,1.32789,1.32541,1.32767,11657,0,0
2025-10-28 18:00:00+00:00,1.32767,1.32835,1.32673,1.32774,9147,0,0
2025-10-28 19:00:00+00:00,1.32774,1.32867,1.32738,1.32782,5613,0,0"""

def calculate_sma(data, period):
    return data.rolling(window=period).mean()

def calculate_ema(data, period):
    return data.ewm(span=period, adjust=False).mean()

def calculate_rsi(data, period=14):
    delta = data.diff()
    gain = (delta.where(delta > 0, 0)).rolling(window=period).mean()
    loss = (-delta.where(delta < 0, 0)).rolling(window=period).mean()
    rs = gain / loss
    rsi = 100 - (100 / (1 + rs))
    return rsi

def calculate_macd(data):
    ema12 = calculate_ema(data, 12)
    ema26 = calculate_ema(data, 26)
    macd_line = ema12 - ema26
    signal_line = calculate_ema(macd_line, 9)
    histogram = macd_line - signal_line
    return macd_line, signal_line, histogram

def calculate_bollinger_bands(data, period=20, std_dev=2):
    sma = calculate_sma(data, period)
    std = data.rolling(window=period).std()
    upper_band = sma + (std * std_dev)
    lower_band = sma - (std * std_dev)
    return upper_band, sma, lower_band

def calculate_stochastic(high, low, close, period=14):
    lowest_low = low.rolling(window=period).min()
    highest_high = high.rolling(window=period).max()
    k = 100 * (close - lowest_low) / (highest_high - lowest_low)
    d = k.rolling(window=3).mean()
    return k, d

def calculate_atr(high, low, close, period=14):
    tr1 = high - low
    tr2 = abs(high - close.shift())
    tr3 = abs(low - close.shift())
    tr = pd.concat([tr1, tr2, tr3], axis=1).max(axis=1)
    atr = tr.rolling(window=period).mean()
    return atr

# Procesar datos
df = pd.read_csv(StringIO(h1_csv))
df['time'] = pd.to_datetime(df['time'])
df = df.sort_values('time').reset_index(drop=True)

# Calcular indicadores
df['sma_20'] = calculate_sma(df['close'], 20)
df['sma_50'] = calculate_sma(df['close'], 50)
df['sma_200'] = calculate_sma(df['close'], 200)
df['rsi'] = calculate_rsi(df['close'])
macd, signal, hist = calculate_macd(df['close'])
df['macd'] = macd
df['macd_signal'] = signal
df['macd_hist'] = hist
upper, middle, lower = calculate_bollinger_bands(df['close'])
df['bb_upper'] = upper
df['bb_middle'] = middle
df['bb_lower'] = lower
k, d = calculate_stochastic(df['high'], df['low'], df['close'])
df['stoch_k'] = k
df['stoch_d'] = d
df['atr'] = calculate_atr(df['high'], df['low'], df['close'])

# Obtener última vela
latest = df.iloc[-1]

print("=" * 60)
print("ANALISIS TECNICO COMPLETO: GBPUSD (Ultimos 2 meses)")
print("=" * 60)
print(f"\nPRECIO ACTUAL: {latest['close']:.5f}")
print(f"Fecha: {latest['time']}")

print(f"\n--- TENDENCIA (Temporal H1) ---")
print(f"  Precio actual: {latest['close']:.5f}")
print(f"  SMA(20):  {latest['sma_20']:.5f}")
print(f"  SMA(50):  {latest['sma_50']:.5f}")
print(f"  SMA(200): {latest['sma_200']:.5f}")

trend_score = 0
if latest['close'] > latest['sma_20']:
    print("   [+] Precio > SMA(20): ALCISTA")
    trend_score += 1
else:
    print("   [-] Precio < SMA(20): BAJISTA")
    trend_score -= 1

if latest['sma_20'] > latest['sma_50']:
    print("   [+] SMA(20) > SMA(50): ALCISTA")
    trend_score += 1
else:
    print("   [-] SMA(20) < SMA(50): BAJISTA")
    trend_score -= 1

if latest['sma_50'] > latest['sma_200']:
    print("   [+] SMA(50) > SMA(200): ALCISTA")
    trend_score += 1
else:
    print("   [-] SMA(50) < SMA(200): BAJISTA")
    trend_score -= 1

print(f"\n--- INDICADORES TECNICOS ---")
print(f"  RSI(14): {latest['rsi']:.2f}")
if latest['rsi'] < 30:
    print("     -> SOBREVENDIDO (potencial compra)")
    rsi_signal = "BUY"
elif latest['rsi'] > 70:
    print("     -> SOBRECOMPRADO (potencial venta)")
    rsi_signal = "SELL"
else:
    print("     -> NEUTRAL")
    rsi_signal = "NEUTRAL"

print(f"\n  MACD:")
print(f"     Linea MACD:  {latest['macd']:.6f}")
print(f"     Senal:       {latest['macd_signal']:.6f}")
print(f"     Histograma:  {latest['macd_hist']:.6f}")
if latest['macd'] > latest['macd_signal']:
    print("     -> ALCISTA (MACD sobre senal)")
    macd_signal = "BUY"
else:
    print("     -> BAJISTA (MACD bajo senal)")
    macd_signal = "SELL"

print(f"\n  Bollinger Bands:")
print(f"     Superior: {latest['bb_upper']:.5f}")
print(f"     Media:    {latest['bb_middle']:.5f}")
print(f"     Inferior: {latest['bb_lower']:.5f}")
bb_position = (latest['close'] - latest['bb_lower']) / (latest['bb_upper'] - latest['bb_lower']) * 100
print(f"     Posicion: {bb_position:.1f}%")

print(f"\n  Stochastic:")
print(f"     %K: {latest['stoch_k']:.2f}")
print(f"     %D: {latest['stoch_d']:.2f}")
if latest['stoch_k'] < 20:
    print("     -> SOBREVENDIDO")
    stoch_signal = "BUY"
elif latest['stoch_k'] > 80:
    print("     -> SOBRECOMPRADO")
    stoch_signal = "SELL"
else:
    print("     -> NEUTRAL")
    stoch_signal = "NEUTRAL"

print(f"\n  ATR(14): {latest['atr']:.5f} (Volatilidad)")

# Calcular probabilidades
probability_long = 50
probability_short = 50

print(f"\n--- CONFLUENCIAS ---")
if trend_score > 0:
    probability_long += 15
    print("  [+] LONG: Tendencia alcista en MAs (+15%)")
if latest['rsi'] < 50 and latest['rsi'] > 30:
    probability_long += 10
    print("  [+] LONG: RSI en zona de compra (+10%)")
if macd_signal == "BUY":
    probability_long += 10
    print("  [+] LONG: MACD alcista (+10%)")
if latest['close'] > latest['bb_middle']:
    probability_long += 10
    print("  [+] LONG: Precio sobre BB media (+10%)")
if latest['stoch_k'] < 50:
    probability_long += 10
    print("  [+] LONG: Stochastic bajo (+10%)")

if trend_score < 0:
    probability_short += 15
    print("  [+] SHORT: Tendencia bajista en MAs (+15%)")
if latest['rsi'] > 50 and latest['rsi'] < 70:
    probability_short += 10
    print("  [+] SHORT: RSI en zona de venta (+10%)")
if macd_signal == "SELL":
    probability_short += 10
    print("  [+] SHORT: MACD bajista (+10%)")
if latest['close'] < latest['bb_middle']:
    probability_short += 10
    print("  [+] SHORT: Precio bajo BB media (+10%)")
if latest['stoch_k'] > 50:
    probability_short += 10
    print("  [+] SHORT: Stochastic alto (+10%)")

probability_long = min(85, max(30, probability_long))
probability_short = min(85, max(30, probability_short))

print(f"\n" + "=" * 60)
print("OPORTUNIDAD DE TRADING RECOMENDADA")
print("=" * 60)

if probability_long > probability_short:
    direction = "LONG (COMPRA)"
    prob = probability_long
    entry = latest['close']
    stop_loss = entry - (2 * latest['atr'])
    take_profit_1 = entry + (2 * latest['atr'])
    take_profit_2 = entry + (3 * latest['atr'])
    pips_sl = abs(entry - stop_loss) * 10000
    pips_tp1 = abs(entry - take_profit_1) * 10000
    pips_tp2 = abs(entry - take_profit_2) * 10000
else:
    direction = "SHORT (VENTA)"
    prob = probability_short
    entry = latest['close']
    stop_loss = entry + (2 * latest['atr'])
    take_profit_1 = entry - (2 * latest['atr'])
    take_profit_2 = entry - (3 * latest['atr'])
    pips_sl = abs(entry - stop_loss) * 10000
    pips_tp1 = abs(entry - take_profit_1) * 10000
    pips_tp2 = abs(entry - take_profit_2) * 10000

print(f"\nDIRECCION:  {direction}")
print(f"PROBABILIDAD DE EXITO: {prob}%")
print(f"\nParametros de la operacion:")
print(f"  Entrada:        {entry:.5f}")
print(f"  Stop Loss:      {stop_loss:.5f}  ({pips_sl:.1f} pips)")
print(f"  Take Profit 1:  {take_profit_1:.5f}  ({pips_tp1:.1f} pips)")
print(f"  Take Profit 2:  {take_profit_2:.5f}  ({pips_tp2:.1f} pips)")
print(f"  Risk/Reward:    1:{abs(take_profit_1-entry)/abs(entry-stop_loss):.2f}")

print(f"\n--- CONTEXTO (Ultimos 2 meses) ---")
print(f"  Maximo:    1.37255 (17 sep 2025)")
print(f"  Minimo:    1.32482 (14 oct 2025)")
print(f"  Rango:     4,773 pips")
print(f"  Precio actual vs maximo: {(1.37255 - latest['close'])*10000:.0f} pips abajo")
print(f"  Precio actual vs minimo: {(latest['close'] - 1.32482)*10000:.0f} pips arriba")
print(f"  Soporte clave:     1.3250 - 1.3280")
print(f"  Resistencia clave: 1.3450 - 1.3500")

print(f"\n[!] ADVERTENCIAS:")
print(f"  * Volatilidad muy alta reciente (ATR elevado)")
print(f"  * Caida fuerte desde maximos")
print(f"  * Zona de consolidacion 1.3300-1.3370")
print(f"  * Verificar calendario economico (BOE, datos UK)")
print(f"  * NO arriesgar mas del 1-2% de tu cuenta")
print("=" * 60)
